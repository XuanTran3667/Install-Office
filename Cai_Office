# Cai_Office.ps1 - Script cai dat Office 2021 Pro Plus tu dong

function Wait-Yes($msg) {
    do {
        $a = Read-Host "$msg (Y/N)"
        if ($a -match '^[Yy]$') { return $true }
        elseif ($a -match '^[Nn]$') {
            Write-Host "‚ùå Da huy buoc nay." -ForegroundColor Red
            exit
        }
    } while ($true)
}

Write-Host "`n=== üöÄ BAT DAU CAI OFFICE 2021 PRO PLUS ===`n" -ForegroundColor Cyan

# Buoc 1: Tao thu muc tam
$temp = "$env:TEMP\office_auto"
if (Test-Path $temp) { Remove-Item -Recurse -Force $temp }
New-Item -ItemType Directory -Path $temp | Out-Null
Set-Location $temp

# Buoc 2: Kiem tra admin
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole('Administrator')) {
    Write-Host "‚ùå Vui long chay script bang quyen Administrator." -ForegroundColor Red
    pause; exit
}

# Buoc 3: Kiem tra WinRAR
$rar = "$env:ProgramFiles\WinRAR\WinRAR.exe"
if (-not (Test-Path $rar)) {
    Write-Host "‚ùå Khong tim thay WinRAR. Hay cai dat WinRAR truoc." -ForegroundColor Red
    pause; exit
}

# Buoc 4: Xac nhan tai file
Wait-Yes "‚û°Ô∏è Ban co muon tai file office.rar?"
$url = "https://drive.usercontent.google.com/download?id=1o4q5VKDpVKifveXv-CTxn5GW9W-omxJz&export=download&authuser=0&confirm=t&uuid=b168a87d-4398-4059-9496-09598ebefe76&at=AN8xHoqhgSmMIMFwsIjsD-WilROH%3A1750332612334"
$out = "$temp\office.rar"
Invoke-WebRequest -Uri $url -OutFile $out

if (-not (Test-Path $out)) {
    Write-Host "‚ùå Loi khi tai file." -ForegroundColor Red
    pause; exit
}

# Buoc 5: Giai nen
Wait-Yes "‚û°Ô∏è Giai nen file office.rar?"
Start-Process -FilePath $rar -ArgumentList "x -o+ office.rar *.*" -Wait

# Buoc 6: Kiem tra file setup
$setup = "$temp\office\setup.exe"
$config = "$temp\office\config.xml"
if (-not (Test-Path $setup) -or -not (Test-Path $config)) {
    Write-Host "‚ùå Khong tim thay setup.exe hoac config.xml." -ForegroundColor Red
    pause; exit
}

# Buoc 7: Cai dat
Wait-Yes "‚û°Ô∏è Bat dau cai dat Office?"
Start-Process -FilePath $setup -ArgumentList "/configure config.xml" -Wait

Write-Host "`n‚úÖ Da hoan tat!" -ForegroundColor Green
pause
